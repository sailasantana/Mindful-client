{"ast":null,"code":"import _classCallCheck from\"/Users/rockerbox/capstones/c2-client/mindful/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/rockerbox/capstones/c2-client/mindful/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/rockerbox/capstones/c2-client/mindful/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/rockerbox/capstones/c2-client/mindful/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import React from'react';import{Link}from'react-router-dom';import AuthApiService from'../Auth-Service/api-auth-service';import TokenService from'../Auth-Service/token-services';import journalContext from'../journal-context';import config from'../config';import'./LoginSignUp.css';var LoginPage=/*#__PURE__*/function(_React$Component){_inherits(LoginPage,_React$Component);var _super=_createSuper(LoginPage);function LoginPage(props){var _this;_classCallCheck(this,LoginPage);_this=_super.call(this,props);_this.handleJwtLoginAuth=function(e){e.preventDefault();_this.setState({error:null});AuthApiService.postLogin({user_name:_this.userInput.current.value,password:_this.passInput.current.value}).then(function(res){localStorage.setItem('user_name',_this.userInput.current.value);_this.context.setUserName(_this.userInput.current.value);TokenService.saveAuthToken(res.token);_this.props.onvalidLogin();var userName=localStorage.getItem('user_name');fetch(\"\".concat(config.API_ENDPOINT,\"/api/\").concat(userName),{headers:{'session_token':\"\".concat(TokenService.getAuthToken())}}).then(function(res){console.log('abcd');if(!res.ok){return res.json().then(function(e){return Promise.reject(e);});}return res.json();}).then(function(posts){localStorage.setItem('posts',posts);var entriesFromStorage=localStorage.getItem('posts');console.log(entriesFromStorage);console.log('abc');_this.context.updatePostsInState(posts);}).catch(function(error){alert({error:error});});}).then(function(){_this.props.history.push('/dashboard');}).catch(function(res){_this.setState({error:alert(\"Invalid username or password. Please re-enter your credentials.\")});});};_this.userInput=/*#__PURE__*/React.createRef();_this.passInput=/*#__PURE__*/React.createRef();_this.state={error:null,posts:[]};return _this;}//handle login auth and validation upon form submission and \n//get user's entries + set them into context\n_createClass(LoginPage,[{key:\"render\",value:function render(){return/*#__PURE__*/_jsxs(\"div\",{class:\"login\",children:[/*#__PURE__*/_jsx(\"img\",{className:\"logo\",src:\"/logo.png\",width:\"210\",height:\"180\"}),/*#__PURE__*/_jsx(\"div\",{className:\"login-triangle\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"login-header\",children:\"Log in to continue\"}),/*#__PURE__*/_jsxs(\"form\",{className:\"login-container\",onSubmit:this.handleJwtLoginAuth,children:[/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"username\",ref:this.userInput,placeholder:\"Username\"})}),/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"password\",ref:this.passInput,placeholder:\"Password\"})}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",value:\"Log in\",className:\"login-button\",children:\"Log In\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"Sign-up-prompt\",children:/*#__PURE__*/_jsx(Link,{to:\"./sign-up\",children:\"New User? Sign Up here!\"})})]});}}]);return LoginPage;}(React.Component);LoginPage.defaultProps={onvalidLogin:function onvalidLogin(){}};LoginPage.contextType=journalContext;export{LoginPage as default};","map":{"version":3,"sources":["/Users/rockerbox/capstones/c2-client/mindful/src/Login/Login.js"],"names":["React","Link","AuthApiService","TokenService","journalContext","config","LoginPage","props","handleJwtLoginAuth","e","preventDefault","setState","error","postLogin","user_name","userInput","current","value","password","passInput","then","res","localStorage","setItem","context","setUserName","saveAuthToken","token","onvalidLogin","userName","getItem","fetch","API_ENDPOINT","headers","getAuthToken","console","log","ok","json","Promise","reject","posts","entriesFromStorage","updatePostsInState","catch","alert","history","push","createRef","state","Component","defaultProps","contextType"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { Link } from 'react-router-dom'\nimport AuthApiService from '../Auth-Service/api-auth-service';\nimport TokenService from '../Auth-Service/token-services';\nimport journalContext from '../journal-context';\nimport config from '../config'\nimport './LoginSignUp.css'\n\n\nexport default class LoginPage extends React.Component {\n\n   static defaultProps = {\n       onvalidLogin: () => {}\n   }; \n\n   static contextType = journalContext;\n\n   constructor(props){\n       super(props);\n       this.userInput = React.createRef();\n       this.passInput = React.createRef();\n\n\n       this.state  = {\n           error : null,\n           posts : []\n    };\n   }\n\n\n\n   //handle login auth and validation upon form submission and \n   //get user's entries + set them into context\n   handleJwtLoginAuth = e => {\n       e.preventDefault();\n       this.setState({\n           error: null\n       });\n\n       AuthApiService.postLogin({\n           user_name:this.userInput.current.value,\n           password : this.passInput.current.value\n        \n       })\n       .then(res => {\n           localStorage.setItem( 'user_name', this.userInput.current.value );\n           this.context.setUserName(this.userInput.current.value) \n           TokenService.saveAuthToken(res.token);\n           this.props.onvalidLogin();\n           let userName = localStorage.getItem('user_name')\n\n            fetch(`${config.API_ENDPOINT}/api/${userName}`, {\n                headers: {\n                  'session_token':`${TokenService.getAuthToken()}`\n                }\n              })\n              .then(res => {\n                  console.log('abcd')\n                if(!res.ok){\n                  return res.json().then(e => Promise.reject(e))\n                }\n                return res.json()\n              })\n\n              .then(posts => {\n                localStorage.setItem( 'posts', posts );\n                let entriesFromStorage = localStorage.getItem('posts')\n                console.log(entriesFromStorage)\n                console.log('abc')\n                this.context.updatePostsInState(posts)\n              })\n              .catch(error => {\n                alert({error})\n              })\n           \n       })\n       .then(() => {\n           this.props.history.push('/dashboard') \n       })\n       .catch(res => {\n           this.setState({\n               error: alert(\"Invalid username or password. Please re-enter your credentials.\")\n           })\n       })\n\n   }\n\n  \n\n    render(){\n\n        return (\n            <div class=\"login\">   \n            <img className = \"logo\" src=\"/logo.png\" width=\"210\" height=\"180\"/>\n              <div className=\"login-triangle\"></div>\n              <h2 className=\"login-header\">Log in to continue</h2>\n              <form className=\"login-container\"  onSubmit = {this.handleJwtLoginAuth}>\n                <p><input type=\"username\" ref={this.userInput} placeholder=\"Username\"/></p>\n                <p><input type=\"password\" ref={this.passInput} placeholder=\"Password\"/></p>\n                <button type=\"submit\" value=\"Log in\" className='login-button'>Log In</button>\n              </form>\n             <p className= 'Sign-up-prompt'><Link to ='./sign-up'>New User? Sign Up here!</Link></p> \n            </div>)\n    }\n\n\n}"]},"metadata":{},"sourceType":"module"}